function Comments(){if(this.api={comments:"/comments/",comment:"/comments/single/"},this.cm=$("#comments"),0==this.cm.length)return!1;this.id=this.cm.data("id");var t=this;this.cm.on("submit","form[name=signin]",function(){var e=$(this).serialize();return $.ajax(t.api.comments+"signin/",{type:"post",data:e,success:function(e){e.error&&t.message(e.error),e.success&&t.load()}}),!1}),this.cm.on("submit","form[name=comment]",function(){var e=$(this),a=e.serialize(),n=e.attr("action");return n=n.length>0?n:t.api.comments+t.id+"/",!e.data("ajaxExec")&&(e.data("ajaxExec",!0),$.ajax(n,{type:"post",data:a,success:function(e){e.error&&t.message(e.error),e.success&&t.load(1)},complete:function(){e.data("ajaxExec",!1)}}),!1)}),this.cm.on("click","a[data-act=edit]",function(){var e=$(this).data("cid");return t.edit(e),!1}),this.cm.on("click","a[data-act=show]",function(){var e=$(this).data("cid");return $(this).addClass("fade"),$.get(t.api.comment+e+"/",function(a){a.error?t.message(a.error):$("#cm_"+e).html(a.data.comment)}),!1}),this.cm.on("click","a[data-act=ignore]",function(){$(this).addClass("fade");var e=$(this).data("cid"),a=$(this).data("block")?0:1;return $.ajax({url:t.api.comments+"ignore/"+e+"/",type:"post",data:{state:a}}).done(function(e){e.error?t.message(e.error):t.load(1)}),!1}),this.cm.on("change","input[data-act=follow]",function(){return $.ajax({url:t.api.comments+"follow/"+t.id+"/",type:"post",data:{follow:1}}),!1}),this.cm.on("click","a[data-act=flag]",function(){var e=$(this),a=e.data("cid"),n=$("<button/>").addClass("btn btn-warning text-bold text-low-up px-5 mt-4").html("Report");n.one("click",function(){$.post(t.api.comments+"flag/"+a+"/"),$("#comment-modal").modal("hide"),e.addClass("fade")});var o=$("<p>Report this comment as spam, offensive or inappropriate?</p>");return t.message(o),o.after(n),!1}),this.cm.on("change keyup paste","textarea[name=commenttext]",function(){var t=$(this),e=t.attr("maxlength"),a=t.val().length;$("#cmChCnt").html(e-a)}),this.cm.on("click","a[data-act=quote]",function(){var e=$(this).data("cid");return $.get(t.api.comment+e+"/",function(e){if(e.error)t.message(e.error);else{var a=t.cm.find("textarea[name=commenttext]");a.val("[q]"+e.data.raw+"[/q]"),a.trigger("change"),a.scrollHere({offset:-75})}}),!1}),this.cm.on("click","a[data-act=vote]",function(){var e=$(this),a=e.data("cid"),n="up"==e.data("vote")?1:-1,o=e.addClass("voted").parent().addClass("disabled").find("[data-sum]").addClass("fade");return $.post(t.api.comments+"rate/"+a+"/",{vote:n},function(e){e.error?t.message(e.error):o.html((parseInt(o.html())+n).toString()),setTimeout(function(){o.removeClass("fade")},250)}),!1})}function nwOptIn(){if(null!=$.cookie("scx_euconsent")){var t=Date.now()/1e3|0,e={hide:!1,v:1,exp:t+604800},a="scxNW",n="scXtestLC";try{localStorage.setItem(n,n),localStorage.removeItem(n)}catch(t){return!1}var o=localStorage.getItem(a),i=$("#js-popup-nwletter");if(null!=o){if((o=JSON.parse(o)).exp<t)localStorage.setItem(a,JSON.stringify(e));else if(!o.hide){if(o.v=parseInt(o.v),o.v++,localStorage.setItem(a,JSON.stringify(o)),o.v>3){var r=$("article.news-article"),s=!1,l=function(){$(window).scrollTop()+$(window).height()+300>=r.offset().top+r.height()&&(i.addClass("popup-cookies__displayed"),$(window).off("scroll",c),clearInterval(d))},c=function(){s=!0},d=setInterval(function(){s&&(l(),s=!1)},250);$(window).on("scroll",c),l()}i.find("form[name=popup-nwletter]").on("submit",function(){o.hide=!0,o.exp=t+31104e3,localStorage.setItem(a,JSON.stringify(o));var e=$(this);return $.ajax("https://sciencex.com/api/nwletter/",{method:"post",data:e.serialize()}).done(function(){e.html("<p>We sent you a confirmation email with a link to activate your subscription</p>")}),!1}),i.find("button[data-dismiss=modal]").on("click",function(){return i.removeClass("popup-cookies__displayed"),o.hide=!0,o.exp=Math.max(o.exp,t+5184e3),localStorage.setItem(a,JSON.stringify(o)),!1})}}else localStorage.setItem(a,JSON.stringify(e))}}$(document).ready(function(){var t=$("#js-soc-panel"),e=parseInt(t.offset().top),a=parseInt(t.offset().left),n=parseInt(t.outerHeight());function o(){if($(window).width()>960){var o=$(document).scrollTop(),i=parseInt($(".news-related").offset().top);o>e?(t.addClass("soc-fixed"),t.css("left",a+"px")):(t.removeClass("soc-fixed"),t.css("left","auto")),o>i-n-50?t.addClass("soc-at-the-bottom"):t.removeClass("soc-at-the-bottom")}}$(".js-article-gallery").lightSlider({gallery:!0,item:1,loop:!0,thumbItem:7,slideMargin:0,enableDrag:!1,currentPagerPosition:"left",mode:"slide",useCSS:!0,cssEasing:"ease",easing:"linear",speed:600,prevHtml:'<svg><use xlink:href="#left-arrow" x="0" y="0"/></svg>',nextHtml:'<svg><use xlink:href="#right-arrow" x="0" y="0"/></svg>',verticalHeight:480,vThumbWidth:100,galleryMargin:5,thumbMargin:10,pager:!0,gallery:!0,currentPagerPosition:"middle",responsive:[{breakpoint:1560,settings:{thumbItem:5}},{breakpoint:1200,settings:{thumbItem:6}},{breakpoint:960,settings:{thumbItem:6}}],onSliderLoad:function(t){t.lightGallery({selector:".js-article-gallery .lslide",getCaptionFromTitleOrAlt:!1,download:!0,thumbnail:!0})}}),o();var i=$("#js-news-related-slider").lightSlider({item:1,slideMargin:0,speed:600,loop:!1,controls:!1,galleryMargin:0,gallery:!1,onSliderLoad:function(t){$(".news-related .lSPager").appendTo(".js-news-related__wrap"),$(".js-news-related__wrap .lSPager").addClass("news-related__custom-dots")},onAfterSlide:function(){for(var t=i.getCurrentSlideCount(),e=document.querySelectorAll(".news-related__custom-dots li a"),a=0;a<e.length;a++)e[a].parentNode.classList.remove("active"),parseInt(e[a].innerHTML)===t&&e[a].parentNode.classList.add("active")}}),r=$(".soc-panel-close button");$(window).width()<960&&(setTimeout(function(){t.addClass("displayed")},1e3),r.click(function(){t.removeClass("displayed")})),$(window).on("scroll",function(){o()})}),$(function(){var t=document.querySelector("link[rel=canonical]"),e=null!==t?t.href:document.location.href,a=function(t,e){var a=t>0?t:500,n=e>0?e:400;return["menubar=no,toolbar=no,resizable=yes,scrollbars=yes","height="+n,"width="+a,"left="+($(window).width()/2-a/2),"top="+($(window).height()/2-n/2)].join()},n=function(t){return!1!==t[0].checkValidity()||(t.find("[required]").each(function(){var t=$(this);t.removeClass("is-invalid"),t[0].willValidate&&!t[0].checkValidity()&&t.addClass("is-invalid")}),!1)};$(".fb").click(function(){return FB.ui({method:"share",mobile_iframe:!0,href:e},function(t){}),!1}),$(".goog").click(function(){return window.open($(this).attr("href"),"",a(600,600)).opener=null,!1}),$(".tw").click(function(){var t="https://twitter.com/intent/tweet?text="+($(this).data("title")+" "+encodeURIComponent(e)+" via @"+$(this).data("via"));return window.open(t,"ShareOnTwitter",a(500,450)).opener=null,!1}),$(".ln").click(function(){var t="https://www.linkedin.com/shareArticle?mini=true&url="+e;return window.open(t,"ShareOnLinkedIN",a(520,570)).opener=null,!1}),$("#fav").click(function(){var t=$(this).data("nid"),e=$.cookie("PhysAccount"),a=e?"?u="+btoa(e):"";return $.ajax("https://sciencex.com/api/story/addFav/"+t+"/"+a,{method:"get",crossDomain:!0}).done(function(){$("#notify").find(".modal-message").html("Saved to your Science X account")}).fail(function(){$("#notify").find(".modal-message").html('Please sign into <a href="https://sciencex.com/profile/login/">Science X account</a>')}).always(function(){$("#notify").modal("show")}),!1}),$("form[name=email]").on("submit",function(){var t=$(this),e=t.attr("action"),a=t.serialize();return!!n(t)&&(a+="&project=physorg&xRequest=true",$.post(e,a).done(function(e){e.error?($("#email-error").html(e.error),2==e.code?t.find("input[type=email]").addClass("is-invalid"):1==e.code&&t.find("[required]").addClass("is-invalid")):(t[0].reset(),$("#feedback-email").modal("hide"))}).fail(function(){t[0].reset(),$("#feedback-email").modal("hide"),alert("An unknown error has occurred")}),!1)}),$("form[name=feedback]").on("submit",function(){var t=$(this),e=t.attr("action"),a=t.serialize();return!!n(t)&&(a+="&xRequest=true",$.post(e,a).always(function(){t.find(".modal-body").hide(),t.find("button[type=submit]").hide(),t.find(".message").removeClass("d-none")}),!1)})}),Comments.prototype={load:function(t){var e=this;this.cm.addClass("fade"),this.cm.load(this.api.comments+this.id+"/"+(1==t?"?s="+Math.random():""),function(){e.cm.removeClass("fade")})},message:function(t){var e=$("#comment-modal");$("#comment-message").html(t),e.modal("show")},edit:function(t){var e=this;$.get(this.api.comment+t+"/").done(function(a){if(a.success){var n=e.cm.find("form[name=comment]");n.find("textarea[name=commenttext]").val(a.data.raw),n.attr("action",e.api.comment+t+"/"),n.scrollHere({offset:-75})}else e.message(a.error)})}},$(document).ready(function(){$(".lightGallery").lightGallery({getCaptionFromTitleOrAlt:!1,download:!0,thumbnail:!0}),$(".text-truncate-js").addClass("text-truncate");var t=$(".article").height();1.15<$(".article-sidebar").height()/t&&new SimpleBar($("#nwrel").addClass("categories-content__pane")[0]);var e=$("#news-more"),a=new Comments;if("IntersectionObserver"in window){var n=new IntersectionObserver(function(t,n){$.each(t,function(){this.intersectionRatio>0&&(e[0]==this.target?e.attr("data-loaded",!0).load("/ajax/story/",{ads:e.data("ads")}):a.cm[0]==this.target&&a.load(),n.unobserve(this.target))})},{rootMargin:parseInt($(window).height()).toString()+"px 0px",threshold:.01});n.observe(e[0]),n.observe(a.cm[0])}else e.attr("data-loaded",!0).load("/ajax/story/",{ads:e.data("ads")}),a.load();nwOptIn()});