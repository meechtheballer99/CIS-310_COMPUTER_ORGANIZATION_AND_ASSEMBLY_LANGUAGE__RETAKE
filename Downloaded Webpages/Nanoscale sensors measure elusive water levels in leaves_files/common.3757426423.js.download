var API="https://sciencex.com/api/apps/web/physorg/",LST="pushNotify",VAPID="BOybuSIA7mfxsvZaBPCz4ZekXRVxHpk1Bt5KqGA1GGb5GNyAywD-ye1wFbPJm8KMnlLGuiBZHO4T0r87SdYnWA0";function Webpush(e){this.control=$("[data-action=webpush]"),"serviceWorker"in navigator&&"PushManager"in window&&this.registerServiceWorker(e)}Webpush.prototype={registerServiceWorker:function(e){var t=this;navigator.serviceWorker.register(e),navigator.serviceWorker.ready.then(function(e){"denied"===Notification.permission?(console.log("Notifications are blocked until this permission is manually changed in the browser"),t.control.addClass("fade"),localStorage&&(localSub=localStorage.getItem(LST))&&t.deleteSubscription(JSON.parse(localSub))):e.pushManager.getSubscription().then(function(o){o?(t.saveSubscription(o),t.control.html("Stop notifications").on("click",function(){o.unsubscribe().then(function(){t.control.addClass("fade"),t.deleteSubscription(o.toJSON())})})):t.createUI(e)}).catch(function(e){console.log("Error during getSubscription()",e)})}).catch(function(e){console.error("Service Worker error",e)})},saveSubscription:function(e){var t;localStorage&&(t=JSON.parse(localStorage.getItem(LST)))&&e.endpoint==t.endpoint||$.ajax(API+"subscribe/",{type:"post",mode:"cors",data:{subscription:e.toJSON(),vapid:VAPID,utc_offset:(new Date).getTimezoneOffset()/-60},success:function(t){t&&0===t.failed&&localStorage&&localStorage.setItem(LST,JSON.stringify({subscription:!0,endpoint:e.endpoint,vapid:VAPID,date:new Date}))}})},deleteSubscription:function(e){$.ajax(API+"unsubscribe/",{type:"post",mode:"cors",data:{subscription:e},success:function(){localStorage&&localStorage.getItem(LST)&&localStorage.removeItem(LST)}})},createUI:function(e){var t=this;this.control.click(function(){return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t.convertVapidKey(VAPID)}).then(function(o){e.showNotification("Awesome!",{body:"We will send you alerts for notable news stories. Please note that this subscription is browser specific, so if you want to receive notifications on another device, you will need to use it to re-subscribe.",icon:"https://sciencex.com/gfx/shared/phys_icon_192.png"}),t.saveSubscription(o),t.control.addClass("fade")}).catch(function(e){console.log("Error during subscribe()",e)}),!1})},convertVapidKey:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(t),a=new Uint8Array(o.length),i=0;i<o.length;++i)a[i]=o.charCodeAt(i);return a}};var adBlockAlert=function(e){var t=void 0===ga.getAll?1:0,o=$.cookie("PhysAccount"),a=o?"&u="+btoa(o):"";$.ajax("https://sciencex.com/api/profile/?t="+t+a,{method:"get",crossDomain:!0,headers:{"x-referer":location.href}}).done(function(t){var o,a;t.premium||(o=$("#adblock").html().trim(),a=$(o),"FF"==e&&a.find("#adblock-type").html("Enhanced Tracking Protection"),$("header.header").append(a),a.addClass("show"))})};function euCookie(){var e=$("#js-popup-cookies"),t=$("[data-cookies-close]");isUserIsBot||null==$.cookie("scx_euconsent")&&$.get("https://sciencex.com/api/location/",function(o){o.gdpr?(e.addClass("popup-cookies__displayed"),t.on("click",function(t){t.preventDefault(),$.cookie("scx_euconsent",1,{path:"/",domain:window.location.hostname.match(/([a-z0-9-]*?\.[a-z]{2,})$/)[1],expires:365}),e.removeClass("popup-cookies__displayed")})):$.cookie("scx_euconsent",0,{path:"/",domain:window.location.hostname.match(/([a-z0-9-]*?\.[a-z]{2,})$/)[1],expires:30})})}function imgDefer(){$("img[data-src]").each(function(){var e=$(this);e.attr("data-src")&&e.attr("src",e.attr("data-src")).removeAttr("data-src").removeClass("hidden")})}$(document).ready(function(){new Webpush("/push-sw.js"),euCookie();var e=$(".header-search__show"),t=$(".header-search__group");t.find(".header-search__field");if(e.click(function(e){$(this).addClass("search-open"),t.addClass("displayed")}),$(document).mouseup(function(o){0===t.has(o.target).length&&(e.removeClass("search-open"),t.removeClass("displayed")),$(".header-collapse").hasClass("show")&&"nav-link"!=o.target.className&&$(".header-collapse").collapse("hide")}),$("#nav-featured").length>0)var o=new SimpleBar($("#nav-featured")[0]);$(window).on("resize",function(){void 0!==o&&o.recalculate()}),$("a[data-toggle=tab]").on("show.bs.tab",function(e){var t=e.target,o=$(t).attr("href").substr(1),a=$("#"+o);if(0!=a.length&&!a.data("loaded")){var i=$(e.relatedTarget).attr("href").substr(1),n=$("#"+i).height();a.height(n+"px").load("/ajax/sort/"+o.substr(4)+"/",function(){setTimeout(function(){a.data("loaded",!0).height("auto"),s=new SimpleBar(a[0])},100)})}}),$("form[name=nwsubscribe]").submit(function(){var e=$(this);return $.ajax("https://sciencex.com/api/nwletter/",{method:"post",data:e.serialize()}).done(function(){e.html("<p>We sent you a confirmation email with a link to activate your subscription</p>")}),!1}),$("a[rel=top]").click(function(){return $.scrollTo($("head")),!1}),$("audio,video").each(function(){new Plyr($(this))}),void 0===window.blockAdBlock?adBlockAlert():(blockAdBlock.on(!0,adBlockAlert),blockAdBlock.on(!1,function(){var e=function(){var t="//www.googletagservices.com/tag/js/gpt.js";if($('script[src*="'+t+'"]').length>0&&void 0===googletag.apiReady){var o=document.createElement("script");o.onerror=adBlockAlert,o.src=t,o.async=1,document.getElementsByTagName("head")[0].appendChild(o)}else"undefined"!=typeof googletag&&googletag.apiReady&&void 0===googletag.pubadsReady&&adBlockAlert("FF");$(window).off("load",e)};"complete"!==document.readyState?$(window).on("load",e):e()}));var a=$("#secondaryNav");$("#collapseNavigation").on("show.bs.collapse",function(){a.css("opacity",0)}),$("#collapseNavigation").on("hide.bs.collapse",function(){a.css("opacity",1)}),$('button[data-target="#collapseNavigation"]').one("click",function(){$("#collapseNavigation").find(".dropdown-nav").load("/ajax/categories/",function(){setTimeout(function(){$(".nav-link[data-href]").one("mouseover",function(){var e=$(this).data("href");$(this).parent().find(".preview-nav").load("/ajax"+e)})},0)})}),"undefined"!=typeof $q&&$.each($q,function(e,t){$(t)}),"1"==$.cookie("physMob")&&$("#nav-mobile").one("click",function(){$.cookie("pdaPhysOrg",0,{path:"/",domain:".phys.org"})});var i=$("[data-col=main]");if(i.length>0){var n=i.children(),r=n.first(),c=n.last(),l=colRH=0;r.children().each(function(){l+=$(this).outerHeight(!0)}),c.children().each(function(){colRH+=$(this).outerHeight(!0)});var d=l-colRH;c.find(".categories_min-height-470").each(function(){var e=$(this).find(".categories-content__pane"),t=e.outerHeight();e.css("max-height",Math.round(t+d/2)+"px"),new SimpleBar(e[0])})}}),$(window).on("load",function(){imgDefer(),$(document).ajaxComplete(function(){setTimeout(imgDefer,0)})});var Navigation=function(){if(this.target="[data-role=page]",0==$(this.target).length)return!1;this.pageBtn=$("a[data-page]"),this.page=this.pageBtn.data("page")-1;var e=$("#block-p1");if(e.length>0){var t=e.find("div[data-order=1]"),o=e.find("div[data-order=2]"),a=0;$(t).children().each(function(){a+=$(this).outerHeight(!0)});var i=0;for($(o).children().each(function(){i+=$(this).outerHeight(!0)});1.03*a<i;){var n=o.children().last(),r=n.outerHeight(!0);n.remove(),i-=r}this.perPage=o.children().length,this.load(this.page+1)}else this.perPage=0;$(this.target).data("page",this.page),this.isLoading=0,this.didScroll=!1,this.historyAPI=window.history&&window.history.replaceState;var s=this;$(window).on("scroll",function(){s.scroll()}),setInterval(function(){s.didScroll&&(s.iniPagination(),s.didScroll=!1)},1250),this.pageBtn.on("click",function(){var e=$(this).data("page");return s.load(e),!1}),this.page>1&&this.preload(this.page-1)};Navigation.prototype={scroll:function(){this.didScroll=!0},mostlyVisible:function(e){var t=$(window).scrollTop(),o=$(e).offset().top,a=$(e).height(),i=$(window).height();return o+a>t+.25*a&&o<t+.5*i},iniPagination:function(){if(this.historyAPI){var e=this;$(this.target).each(function(t){if(e.mostlyVisible(this)){var o=$(this).attr("data-page");if(o!=e.page){e.page=o;var a=1==o?"./":"./page"+o+".html";history.replaceState(null,null,a),e.page>1?("scrollRestoration"in history&&(history.scrollRestoration="manual"),e.preload(e.page-1)):"scrollRestoration"in history&&(history.scrollRestoration="auto")}return!1}})}},load:function(e){if(this.isLoading)return!1;this.isLoading=!0,this.pageBtn.addClass("disabled");var t=this,o="./page"+e+".html";$.get(o,{l:t.perPage,cache:(new Date).getTime()}).done(function(o){o.length>0&&($("#load-more").append(o),t.pageBtn.data("page",e+1).removeClass("disabled"))}).fail(function(){t.pageBtn.remove()}).always(function(){t.isLoading=0})},preload:function(e){if(e<2)return $(".first-page-content").hasClass("very-top")&&($(".first-page-content").removeClass("very-top"),$(window).scrollTop($(window).scrollTop()+$(".first-page-content").height())),!1;if($("div[data-page="+e+"]").length>0)return!1;if(this.isLoading)return!1;this.isLoading=1;var t=this,o="./page"+e+".html";$.get(o,{l:t.perPage,cache:(new Date).getTime()}).done(function(t){var o=$("div[data-page="+(e+1)+"]"),a=$(t);o.length>0?(o.before(a),document.querySelector("html").setAttribute("style","scroll-behavior: auto;"),$(window).scrollTop($(window).scrollTop()+a.height()),document.querySelector("html").setAttribute("style","")):(o=$("div[data-page="+(e-1)+"]")).length>0?o.after(t):($("#load-more").prepend(t),document.querySelector("html").setAttribute("style","scroll-behavior: auto;"),window.scrollTo(0,$(window).scrollTop()+a.height()),document.querySelector("html").setAttribute("style",""))}).always(function(){t.isLoading=0})}},$(document).ready(function(){new Navigation});